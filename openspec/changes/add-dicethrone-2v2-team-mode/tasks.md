## 1. Implementation
- [ ] 1.1 扩展 DiceThrone 房间配置：`playerOptions` 支持 `[2,4]`，引擎配置 `minPlayers/maxPlayers` 支持 4 人。
- [ ] 1.2 设计并落地团队状态模型（队伍归属、共享体力、上限策略），确保 1v1 与 2v2 可共存。
- [ ] 1.3 新增 2v2 站位配置输入：默认站位采用官方座位顺序，并允许开局前“点击空位移动位置”。
- [ ] 1.4 新增站位合法性校验：仅允许移动到空位，不允许交换位；开始后锁定站位。
- [ ] 1.5 改造回合顺序函数（`getPlayerOrder/getNextPlayerId`）为 2v2 队伍交替序列，并处理不同起始玩家轮转。
- [ ] 1.6 新增 2v2 目标掷骰阶段（Targeting Roll）：按 d6 规则确定防御方，接入阶段推进与命令校验。
- [ ] 1.7 补齐 2v2 目标选择全部新交互流程：1/2 自动锁定左侧对手、3/4 自动锁定右侧对手、5 由被攻击方队伍选择、6 由进攻方选择。
- [ ] 1.8 改造攻击发起与卡牌执行中的目标选择逻辑，移除“唯一对手推断”路径。
- [ ] 1.9 改造伤害/治疗与战斗收尾逻辑，使共享体力在攻击、附属伤害、治疗、上限钳制下行为一致。
- [ ] 1.10 改造响应队列与可打牌窗口，满足 2v2 干预规则（队友可改骰，队友不可直接替队友承受/减免输出伤害，且队友不响应队友，除非牌面明确允许）。
- [ ] 1.11 改造 `isGameOver` 为队伍判定（队伍 HP<=0 失败、双方同时归零平局）。
- [ ] 1.12 改造 `playerView` 与前端 Board 玩家映射：队友手牌可见、对手隐藏，4 人布局与目标展示正确。
- [ ] 1.13 在选角界面右下红框区域接入“目标交互/站位面板”（默认值、点击空位移动、非法操作反馈、锁定态）。
- [ ] 1.14 实现顶部并排 3 个他人悬浮窗（2 敌 + 1 友），并通过边缘高亮明确区分敌我。
- [ ] 1.15 实现“攻击阶段结束后的目标选择面板”：展示 3 个可选目标，样式复用悬浮窗并纵向排列，点击即确认目标。
- [ ] 1.16 将目标选择结果与 Targeting Roll 分支打通：目标确认后写入 defenderId 并回显。
- [ ] 1.17 改造服务端创建与入座：`/games/:name/create` 按游戏配置校验人数；4 座位元数据、claim-seat 状态流转正确。
- [ ] 1.18 补充并更新测试：规则函数、站位移动校验、目标选择交互分支、攻击/结算、胜负判定、视图过滤、服务端创建与入座流程（2 人与 4 人均覆盖）。

## 2. Validation
- [ ] 2.1 `openspec validate add-dicethrone-2v2-team-mode --strict --no-interactive` 通过。
- [ ] 2.2 DiceThrone 领域测试新增 2v2 覆盖并通过（回合顺序、目标掷骰、共享体力、胜负判定）。
- [ ] 2.3 服务端路由与大厅流程验证通过（创建 4 人房、4 人入座后进入 playing）。
- [ ] 2.4 手动走查站位交互链路：默认站位显示正确，点击空位移动生效，尝试交换位被拒绝。
- [ ] 2.5 手动走查目标交互链路：1/2、3/4 自动目标正确；5 由防守队选择；6 由进攻方选择。
- [ ] 2.6 手动走查顶部悬浮窗链路：顶部 3 窗并排稳定，敌我边缘高亮正确。
- [ ] 2.7 手动走查目标面板链路：攻击阶段结束后出现 3 目标竖排，点击后立即确认并关闭。
- [ ] 2.8 手动走查 2v2 对局主链路：开房→入座→选角/站位→目标掷骰→攻击/防御→团队胜负。
- [ ] 2.9 手动走查响应窗口链路：同队玩家不会进入同队响应队列（队友不响应队友）。
