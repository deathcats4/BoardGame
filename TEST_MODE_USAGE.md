# 🧪 测试模式使用说明

## 功能概述

调试工具新增了**测试模式**功能，可以在执行游戏行动后自动切换到另一个玩家的视角，大大提升多人对局测试效率。

## 默认状态

- **默认开启**：测试模式在首次使用时默认为开启状态
- **状态持久化**：测试模式的开关状态会保存在浏览器本地存储中

## 使用方法

### 1. 打开调试工具

点击页面右下角的 🛠️ 按钮打开调试面板

### 2. 查看/切换测试模式

1. 切换到 **⚙️ 系统** 标签页
2. 查看顶部的 **🧪 测试模式** 卡片
3. 点击右侧的开关按钮可以切换测试模式

### 3. 测试模式开启时

- ✅ **状态提示**：显示 "已开启 - 行动后自动切换视角"
- 🎮 **执行行动**：在"🎮 指令"标签页执行任意move
- 🔄 **自动切换**：执行后延迟300ms，视角自动切换到另一个玩家（P0 ⇄ P1）
- 👀 **视角指示**：调试面板顶部显示当前视角（P0/P1/旁观）

### 4. 测试模式关闭时

- ⏸️ **状态提示**：显示 "已关闭 - 需手动切换视角"
- 🎮 **执行行动**：执行move后视角保持不变
- 👋 **手动切换**：需要手动点击顶部的 P0/P1/旁观 按钮切换视角

## UI 元素说明

### 测试模式开关

```
🧪 测试模式
执行行动后自动切换玩家视角

[━━━━━━━○] ← 绿色表示开启，灰色表示关闭
```

### 状态指示

- **开启状态**：
  - 开关为绿色，滑块在右侧
  - 底部显示绿色提示框："✅ 已开启 - 行动后自动切换视角"

- **关闭状态**：
  - 开关为灰色，滑块在左侧
  - 底部显示灰色提示框："⏸️ 已关闭 - 需手动切换视角"

## 技术实现

### 自动切换逻辑

```typescript
// 执行行动后触发
autoSwitchPlayer(ctx.currentPlayer)

// 延迟300ms后切换（让动画/状态更新完成）
setTimeout(() => {
    const nextPlayer = currentPlayer === '0' ? '1' : '0';
    setPlayerID(nextPlayer);
}, 300);
```

### 状态持久化

- **本地存储键**：`debug_testMode`
- **存储值**：`"true"` 或 `"false"`
- **默认值**：首次使用时为 `true`（开启）

## 使用场景

### 适合开启测试模式

- ✅ 测试双人对局流程
- ✅ 验证不同玩家视角的UI显示
- ✅ 快速体验完整对局
- ✅ 检查回合切换逻辑

### 适合关闭测试模式

- ⏸️ 专注于单个玩家的操作
- ⏸️ 调试特定玩家的状态
- ⏸️ 验证权限控制（某玩家不能执行某操作）
- ⏸️ 观察游戏状态变化细节

## 兼容性

- 支持所有基于 Boardgame.io 的游戏
- 适用于 2 人游戏（P0 ⇄ P1 切换）
- 开发环境专用（`import.meta.env.DEV` 检测）

## 注意事项

1. **延迟切换**：切换有 300ms 延迟，确保动画和状态更新完成
2. **仅限开发**：调试工具仅在开发模式下显示
3. **本地存储**：测试模式状态保存在浏览器本地，清除缓存会重置为默认值（开启）

---

*最后更新：2026-01-20*
