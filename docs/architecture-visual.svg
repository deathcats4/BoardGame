<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 3200" font-family="'Segoe UI','Microsoft YaHei',system-ui,sans-serif">
<defs>
  <style>
    @keyframes fadeInUp { from { opacity:0; transform:translateY(20px) } to { opacity:1; transform:translateY(0) } }
    @keyframes flowDown { from { stroke-dashoffset:24 } to { stroke-dashoffset:0 } }
    @keyframes pulse { 0%,100%{ opacity:.7 } 50%{ opacity:1 } }

    .layer { opacity:0; animation: fadeInUp .5s ease-out forwards }
    .L1 { animation-delay:.2s } .L2 { animation-delay:.4s } .L3 { animation-delay:.6s }
    .L4 { animation-delay:.8s } .L5 { animation-delay:1s }
    .dep-arrow { stroke-dasharray:6,4; animation: flowDown .8s linear infinite }

    .title   { font-size:28px; font-weight:700; fill:#1e293b }
    .subtitle{ font-size:16px; fill:#64748b }
    .sec     { font-size:22px; font-weight:700; fill:#1e293b }
    .lbl     { font-size:15px; font-weight:600; fill:#fff }
    .sub     { font-size:11px; fill:rgba(255,255,255,.85) }
    .note    { font-size:11px; fill:#64748b }
    .mono    { font-family:'Consolas','Courier New',monospace; font-size:11px; fill:#334155 }
    .card    { filter: drop-shadow(0 2px 6px rgba(0,0,0,.08)) }
    .hook-line { stroke-dasharray:5,3; animation: pulse 2s ease-in-out infinite }

    .pipe-step { opacity:0; animation: fadeInUp .4s ease-out forwards }
    .PS1{animation-delay:1.4s} .PS2{animation-delay:1.6s} .PS3{animation-delay:1.8s}
    .PS4{animation-delay:2.0s} .PS5{animation-delay:2.2s} .PS6{animation-delay:2.4s}
    .PS7{animation-delay:2.6s} .PS8{animation-delay:2.8s}
  </style>

  <linearGradient id="gUI" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stop-color="#3b82f6"/><stop offset="100%" stop-color="#2563eb"/></linearGradient>
  <linearGradient id="gGame" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stop-color="#10b981"/><stop offset="100%" stop-color="#059669"/></linearGradient>
  <linearGradient id="gEng" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#d97706"/></linearGradient>
  <linearGradient id="gCore" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stop-color="#8b5cf6"/><stop offset="100%" stop-color="#7c3aed"/></linearGradient>
  <linearGradient id="gSrv" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stop-color="#6b7280"/><stop offset="100%" stop-color="#4b5563"/></linearGradient>

  <linearGradient id="gCmd" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ef4444"/><stop offset="100%" stop-color="#dc2626"/></linearGradient>
  <linearGradient id="gVal" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#d97706"/></linearGradient>
  <linearGradient id="gExe" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#10b981"/><stop offset="100%" stop-color="#059669"/></linearGradient>
  <linearGradient id="gRed" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#8b5cf6"/><stop offset="100%" stop-color="#7c3aed"/></linearGradient>
  <linearGradient id="gSys" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#0891b2"/></linearGradient>
  <linearGradient id="gNew" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ec4899"/><stop offset="100%" stop-color="#db2777"/></linearGradient>
  <linearGradient id="gOut" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#22c55e"/><stop offset="100%" stop-color="#16a34a"/></linearGradient>

  <marker id="aW" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0,10 3.5,0 7" fill="#94a3b8"/></marker>
  <marker id="aR" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0,10 3.5,0 7" fill="#ef4444"/></marker>
  <marker id="aC" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0,10 3.5,0 7" fill="#06b6d4"/></marker>
  <marker id="aG" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0,10 3.5,0 7" fill="#10b981"/></marker>
</defs>

<rect width="1200" height="3200" fill="#f8fafc"/>

<!-- ================================================================ -->
<!-- æ ‡é¢˜ -->
<!-- ================================================================ -->
<text x="600" y="44" text-anchor="middle" class="title">BordGame å¼•æ“æ¶æ„ v5</text>
<text x="600" y="68" text-anchor="middle" class="subtitle">æ·±å…¥å†…éƒ¨ç»“æ„ Â· å‘½ä»¤â†’äº‹ä»¶ç®¡çº¿ Â· 11 ä¸ªç³»ç»Ÿæ’ä»¶ Â· 10 ä¸ªåŸºç¡€èƒ½åŠ›</text>

<!-- ================================================================ -->
<!-- ä¸€ã€å®è§‚åˆ†å±‚ -->
<!-- ================================================================ -->
<text x="60" y="108" class="sec">ä¸€ã€å®è§‚åˆ†å±‚</text>
<line x1="60" y1="116" x2="240" y2="116" stroke="#e2e8f0" stroke-width="2"/>

<g class="layer L1 card"><rect x="120" y="135" width="960" height="52" rx="10" fill="url(#gUI)"/>
  <text x="600" y="160" text-anchor="middle" class="lbl">UI å±‚ â€” ç©å®¶çœ‹åˆ°çš„ä¸€åˆ‡</text>
  <text x="600" y="177" text-anchor="middle" class="sub">React 19 Â· Board.tsx Â· ç‰¹æ•ˆç³»ç»Ÿ(Canvas/WebGL) Â· Hooks Â· Contexts</text>
</g>
<line x1="600" y1="187" x2="600" y2="200" stroke="#94a3b8" stroke-width="1.5" class="dep-arrow" marker-end="url(#aW)"/>

<g class="layer L2 card"><rect x="120" y="203" width="960" height="52" rx="10" fill="url(#gGame)"/>
  <text x="600" y="228" text-anchor="middle" class="lbl">æ¸¸æˆå±‚ â€” æ¯ä¸ªæ¸¸æˆçš„è§„åˆ™å’Œé€»è¾‘</text>
  <text x="600" y="245" text-anchor="middle" class="sub">games/dicethrone Â· games/summonerwars Â· games/smashup Â· å„è‡ªç‹¬ç«‹çš„ domain/</text>
</g>
<line x1="600" y1="255" x2="600" y2="268" stroke="#94a3b8" stroke-width="1.5" class="dep-arrow" marker-end="url(#aW)"/>

<g class="layer L3 card"><rect x="120" y="271" width="960" height="52" rx="10" fill="url(#gEng)"/>
  <text x="600" y="296" text-anchor="middle" class="lbl">å¼•æ“å±‚ â€” æ‰€æœ‰æ¸¸æˆå…±äº«çš„æ‰§è¡Œæ¡†æ¶</text>
  <text x="600" y="313" text-anchor="middle" class="sub">adapter Â· pipeline Â· 11 ä¸ªç³»ç»Ÿæ’ä»¶ Â· 10 ä¸ªåŸºç¡€èƒ½åŠ› Â· æµ‹è¯•å·¥å…· Â· FX ç®¡çº¿</text>
</g>
<line x1="600" y1="323" x2="600" y2="336" stroke="#94a3b8" stroke-width="1.5" class="dep-arrow" marker-end="url(#aW)"/>

<g class="layer L4 card"><rect x="120" y="339" width="960" height="52" rx="10" fill="url(#gCore)"/>
  <text x="600" y="364" text-anchor="middle" class="lbl">æ¡†æ¶æ ¸å¿ƒ â€” ç±»å‹å¥‘çº¦ + ä¼ è¾“å±‚</text>
  <text x="600" y="381" text-anchor="middle" class="sub">MatchState&lt;TCore&gt; Â· èµ„æºåŠ è½½ Â· æ¸¸æˆæ³¨å†Œè¡¨ Â· ä¼ è¾“å±‚çŠ¶æ€åŒæ­¥</text>
</g>
<line x1="600" y1="391" x2="600" y2="404" stroke="#94a3b8" stroke-width="1.5" class="dep-arrow" marker-end="url(#aW)"/>

<g class="layer L5 card"><rect x="120" y="407" width="960" height="52" rx="10" fill="url(#gSrv)"/>
  <text x="600" y="432" text-anchor="middle" class="lbl">æœåŠ¡ç«¯ â€” ç½‘ç»œ + æŒä¹…åŒ–</text>
  <text x="600" y="449" text-anchor="middle" class="sub">GameTransportServer Â· socket.io å®æ—¶é€šä¿¡ Â· MongoDB å­˜å‚¨ Â· NestJS API</text>
</g>

<text x="1095" y="320" text-anchor="middle" class="note" transform="rotate(-90,1095,320)">ä¾èµ–æ–¹å‘ â–¼ï¼ˆä¸¥æ ¼å•å‘ï¼‰</text>

<!-- ================================================================ -->
<!-- äºŒã€å‘½ä»¤æ‰§è¡Œç®¡çº¿ï¼ˆå‚ç›´æ·±å…¥ç‰ˆï¼‰ -->
<!-- ================================================================ -->
<text x="60" y="520" class="sec">äºŒã€å‘½ä»¤æ‰§è¡Œç®¡çº¿ â€” ä¸€æ¡å‘½ä»¤å¦‚ä½•å˜æˆçŠ¶æ€æ›´æ–°</text>
<line x1="60" y1="528" x2="560" y2="528" stroke="#e2e8f0" stroke-width="2"/>
<text x="60" y="548" class="note">executePipeline() çš„å®Œæ•´å†…éƒ¨æµç¨‹ï¼Œå·¦ä¾§æ˜¯ä¸»é“¾è·¯ï¼Œå³ä¾§æ˜¯ç³»ç»Ÿä»‹å…¥ç‚¹</text>

<!-- Step 1: Command -->
<g class="pipe-step PS1 card">
  <rect x="160" y="570" width="280" height="50" rx="10" fill="url(#gCmd)"/>
  <text x="190" y="592" font-size="18" fill="#fff">â‘ </text>
  <text x="220" y="592" font-size="14" font-weight="600" fill="#fff">Command åˆ°è¾¾</text>
  <text x="220" y="610" font-size="10" fill="rgba(255,255,255,.8)">ç©å®¶æ„å›¾ï¼štype + playerId + payload</text>
</g>
<line x1="300" y1="620" x2="300" y2="640" stroke="#ef4444" stroke-width="2" marker-end="url(#aR)"/>

<!-- Step 2: beforeCommand -->
<g class="pipe-step PS2 card">
  <rect x="160" y="645" width="280" height="70" rx="10" fill="url(#gSys)"/>
  <text x="190" y="672" font-size="18" fill="#fff">â‘¡</text>
  <text x="220" y="672" font-size="14" font-weight="600" fill="#fff">ç³»ç»Ÿå‰ç½®æ‹¦æˆª</text>
  <text x="220" y="690" font-size="10" fill="rgba(255,255,255,.8)">beforeCommand â€” å¯ haltï¼ˆæ¶ˆè´¹å‘½ä»¤ï¼‰</text>
  <text x="220" y="704" font-size="10" fill="rgba(255,255,255,.8)">æˆ–æ³¨å…¥äº‹ä»¶åç»§ç»­</text>
</g>
<line x1="440" y1="680" x2="490" y2="680" stroke="#06b6d4" stroke-width="1.5" class="hook-line" marker-end="url(#aC)"/>
<g class="pipe-step PS2">
  <rect x="495" y="630" width="340" height="115" rx="8" fill="#fff" stroke="#06b6d4" stroke-width="1.5"/>
  <text x="510" y="652" font-size="12" font-weight="600" fill="#0891b2">å“ªäº›ç³»ç»Ÿåœ¨è¿™é‡Œä»‹å…¥ï¼Ÿ</text>
  <line x1="510" y1="659" x2="820" y2="659" stroke="#e0f2fe" stroke-width="1"/>
  <text x="510" y="678" class="mono">ğŸ”’ UndoSystem     â†’ ä¿å­˜çŠ¶æ€å¿«ç…§</text>
  <text x="510" y="696" class="mono">ğŸ”„ FlowSystem     â†’ æ‹¦æˆª ADVANCE_PHASE</text>
  <text x="510" y="714" class="mono">ğŸš« ResponseWindow  â†’ é˜»å¡éå“åº”è€…å‘½ä»¤</text>
  <text x="510" y="732" class="mono">ğŸ“– TutorialSystem â†’ å‘½ä»¤é—¨æ§ï¼ˆæ•™ç¨‹æ­¥éª¤ï¼‰</text>
</g>

<g class="pipe-step PS2">
  <rect x="855" y="645" width="220" height="70" rx="8" fill="#fef2f2" stroke="#fecaca" stroke-width="1"/>
  <text x="870" y="667" font-size="11" font-weight="600" fill="#dc2626">halt = true æ—¶</text>
  <text x="870" y="685" font-size="10" fill="#334155">è·³è¿‡ validate/execute</text>
  <text x="870" y="700" font-size="10" fill="#334155">ç›´æ¥ reduce ç³»ç»Ÿäº‹ä»¶ â†’ afterEvents</text>
  <line x1="835" y1="680" x2="855" y2="680" stroke="#fecaca" stroke-width="1.5" stroke-dasharray="4,3"/>
</g>

<line x1="300" y1="715" x2="300" y2="735" stroke="#ef4444" stroke-width="2" marker-end="url(#aR)"/>

<!-- Step 3: validate -->
<g class="pipe-step PS3 card">
  <rect x="160" y="740" width="280" height="50" rx="10" fill="url(#gVal)"/>
  <text x="190" y="762" font-size="18" fill="#fff">â‘¢</text>
  <text x="220" y="762" font-size="14" font-weight="600" fill="#fff">é¢†åŸŸæ ¡éªŒ validate()</text>
  <text x="220" y="780" font-size="10" fill="rgba(255,255,255,.8)">è§„åˆ™åˆæ³•æ€§ Â· ç©å®¶æƒé™ Â· skipValidation è·³è¿‡</text>
</g>
<line x1="440" y1="765" x2="495" y2="765" stroke="#fde68a" stroke-width="1.5" stroke-dasharray="4,3"/>
<g class="pipe-step PS3">
  <rect x="495" y="745" width="220" height="40" rx="6" fill="#fffbeb" stroke="#fde68a" stroke-width="1"/>
  <text x="510" y="764" font-size="10" fill="#92400e">âš  æ ¡éªŒå¤±è´¥ â†’ ç«‹å³è¿”å› { success: false }</text>
  <text x="510" y="778" font-size="10" fill="#92400e">å‘½ä»¤è¢«æ‹’ç»ï¼ŒçŠ¶æ€ä¸å˜</text>
</g>

<line x1="300" y1="790" x2="300" y2="810" stroke="#ef4444" stroke-width="2" marker-end="url(#aR)"/>

<!-- Step 4: execute -->
<g class="pipe-step PS4 card">
  <rect x="160" y="815" width="280" height="50" rx="10" fill="url(#gExe)"/>
  <text x="190" y="837" font-size="18" fill="#fff">â‘£</text>
  <text x="220" y="837" font-size="14" font-weight="600" fill="#fff">æ‰§è¡Œå‘½ä»¤ execute()</text>
  <text x="220" y="855" font-size="10" fill="rgba(255,255,255,.8)">Command â†’ Event[]ï¼ˆäº§ç”Ÿæƒå¨åæœï¼‰</text>
</g>
<line x1="440" y1="840" x2="490" y2="840" stroke="#10b981" stroke-width="1.5" stroke-dasharray="4,3" marker-end="url(#aG)"/>
<g class="pipe-step PS4">
  <rect x="495" y="818" width="260" height="45" rx="6" fill="#f0fdf4" stroke="#bbf7d0" stroke-width="1"/>
  <text x="510" y="837" font-size="10" fill="#166534">æ¸¸æˆå±‚çº¯å‡½æ•°ï¼Œä¸ä¿®æ”¹çŠ¶æ€</text>
  <text x="510" y="852" font-size="10" fill="#166534">åªæ ¹æ®å½“å‰çŠ¶æ€+å‘½ä»¤ â†’ ç”Ÿæˆäº‹ä»¶åˆ—è¡¨</text>
</g>

<line x1="300" y1="865" x2="300" y2="885" stroke="#ef4444" stroke-width="2" marker-end="url(#aR)"/>

<!-- Step 5: postProcess -->
<g class="pipe-step PS5 card">
  <rect x="160" y="890" width="280" height="50" rx="10" fill="url(#gNew)"/>
  <text x="190" y="912" font-size="18" fill="#fff">â‘¤</text>
  <text x="220" y="912" font-size="14" font-weight="600" fill="#fff">åå¤„ç† postProcess()</text>
  <text x="220" y="930" font-size="10" fill="rgba(255,255,255,.8)">æ³¨å…¥æ´¾ç”Ÿäº‹ä»¶ï¼ˆç±»ä¼¼ä¸‡æ™ºç‰Œ SBAï¼‰</text>
</g>
<line x1="440" y1="915" x2="490" y2="915" stroke="#ec4899" stroke-width="1.5" stroke-dasharray="4,3"/>
<g class="pipe-step PS5">
  <rect x="495" y="895" width="260" height="40" rx="6" fill="#fdf2f8" stroke="#fbcfe8" stroke-width="1"/>
  <text x="510" y="912" font-size="10" fill="#831843">å¯é€‰ã€‚ä¾‹ï¼šæ£€æµ‹ç”Ÿå‘½å€¼å½’é›¶ â†’ æ³¨å…¥æ­»äº¡äº‹ä»¶</text>
  <text x="510" y="926" font-size="10" fill="#831843">çŠ¶æ€æ£€æµ‹ â†’ è‡ªåŠ¨è¡¥å……ç¼ºå¤±çš„äº‹ä»¶</text>
</g>

<line x1="300" y1="940" x2="300" y2="960" stroke="#ef4444" stroke-width="2" marker-end="url(#aR)"/>

<!-- Step 6: interceptEvent + reduce -->
<g class="pipe-step PS6 card">
  <rect x="130" y="965" width="340" height="100" rx="10" fill="url(#gRed)"/>
  <text x="160" y="992" font-size="18" fill="#fff">â‘¥</text>
  <text x="190" y="992" font-size="14" font-weight="600" fill="#fff">é€äº‹ä»¶ reduce å¾ªç¯</text>
  <text x="190" y="1012" font-size="10" fill="rgba(255,255,255,.85)">for (event of events) {</text>
  <text x="200" y="1028" font-size="10" fill="rgba(255,255,255,.85)">  interceptEvent â†’ æ›¿æ¢/åå™¬/åˆ†è£‚</text>
  <text x="200" y="1044" font-size="10" fill="rgba(255,255,255,.85)">  reduce(core, event) â†’ çº¯å‡½æ•°æ›´æ–° core</text>
  <text x="190" y="1058" font-size="10" fill="rgba(255,255,255,.85)">}</text>
</g>
<line x1="470" y1="1015" x2="495" y2="1015" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="4,3"/>
<g class="pipe-step PS6">
  <rect x="500" y="968" width="360" height="95" rx="8" fill="#fff" stroke="#c4b5fd" stroke-width="1.5"/>
  <text x="515" y="990" font-size="12" font-weight="600" fill="#7c3aed">reduce å¾ªç¯å†…éƒ¨</text>
  <line x1="515" y1="997" x2="845" y2="997" stroke="#ede9fe" stroke-width="1"/>
  <text x="515" y="1016" class="mono">event â†’ interceptEvent(core, event)</text>
  <text x="515" y="1032" class="mono">  â†’ null: äº‹ä»¶è¢«åå™¬ï¼ˆå¦‚æŠ¤ç”²å¸æ”¶ä¼¤å®³ï¼‰</text>
  <text x="515" y="1048" class="mono">  â†’ event[]: äº‹ä»¶è¢«æ›¿æ¢/åˆ†è£‚ä¸ºå¤šä¸ª</text>
  <text x="515" y="1064" class="mono">æ¯ä¸ªæœ€ç»ˆäº‹ä»¶ â†’ reduce(core, evt) â†’ æ–° core</text>
</g>
<g class="pipe-step PS6">
  <rect x="880" y="968" width="195" height="95" rx="8" fill="#fef2f2" stroke="#fecaca" stroke-width="1"/>
  <text x="895" y="990" font-size="11" font-weight="600" fill="#dc2626">âš  æ€§èƒ½è¦æ±‚</text>
  <text x="895" y="1010" font-size="10" fill="#334155">reduce å¿…é¡»ç»“æ„å…±äº«</text>
  <text x="895" y="1026" font-size="10" fill="#334155">åª spread å˜æ›´è·¯å¾„</text>
  <text x="895" y="1046" font-size="10" fill="#dc2626">âŒ ç¦æ­¢ JSON.parse/</text>
  <text x="895" y="1058" font-size="10" fill="#dc2626">   JSON.stringify</text>
</g>

<line x1="300" y1="1065" x2="300" y2="1085" stroke="#ef4444" stroke-width="2" marker-end="url(#aR)"/>

<!-- Step 7: afterEvents -->
<g class="pipe-step PS7 card">
  <rect x="160" y="1090" width="280" height="70" rx="10" fill="url(#gSys)"/>
  <text x="190" y="1117" font-size="18" fill="#fff">â‘¦</text>
  <text x="220" y="1117" font-size="14" font-weight="600" fill="#fff">ç³»ç»Ÿåç½®å“åº”</text>
  <text x="220" y="1135" font-size="10" fill="rgba(255,255,255,.8)">afterEvents â€” å¯äº§ç”Ÿæ–°äº‹ä»¶ â†’ å¤šè½®è¿­ä»£</text>
  <text x="220" y="1149" font-size="10" fill="rgba(255,255,255,.8)">æœ€å¤š 10 è½®ï¼Œæ— æ–°äº‹ä»¶æ—¶åœæ­¢</text>
</g>
<path d="M 440 1125 C 460 1125, 460 1090, 440 1090" fill="none" stroke="#06b6d4" stroke-width="1.5" stroke-dasharray="4,3" marker-end="url(#aC)"/>
<text x="468" y="1108" font-size="9" fill="#0891b2" font-weight="500">æœ‰æ–°äº‹ä»¶</text>
<text x="468" y="1120" font-size="9" fill="#0891b2">åˆ™å›åˆ° â‘¥</text>

<line x1="440" y1="1130" x2="490" y2="1130" stroke="#06b6d4" stroke-width="1.5" class="hook-line" marker-end="url(#aC)"/>
<g class="pipe-step PS7">
  <rect x="495" y="1082" width="340" height="100" rx="8" fill="#fff" stroke="#06b6d4" stroke-width="1.5"/>
  <text x="510" y="1104" font-size="12" font-weight="600" fill="#0891b2">å“ªäº›ç³»ç»Ÿåœ¨è¿™é‡Œä»‹å…¥ï¼Ÿ</text>
  <line x1="510" y1="1111" x2="820" y2="1111" stroke="#e0f2fe" stroke-width="1"/>
  <text x="510" y="1130" class="mono">ğŸ“‹ LogSystem       â†’ æŒä¹…åŒ–äº‹ä»¶æ—¥å¿—</text>
  <text x="510" y="1148" class="mono">ğŸ“¡ EventStream     â†’ æ¨é€äº‹ä»¶ç»™ UI ç‰¹æ•ˆ</text>
  <text x="510" y="1166" class="mono">ğŸ”„ FlowSystem      â†’ è‡ªåŠ¨é˜¶æ®µæ¨è¿›</text>
  <text x="510" y="1184" class="mono">ğŸªŸ ResponseWindow   â†’ æ‰“å¼€/å…³é—­å“åº”çª—å£</text>
</g>

<line x1="300" y1="1160" x2="300" y2="1180" stroke="#ef4444" stroke-width="2" marker-end="url(#aR)"/>

<!-- Step 8: Result -->
<g class="pipe-step PS8 card">
  <rect x="160" y="1185" width="280" height="50" rx="10" fill="url(#gOut)"/>
  <text x="190" y="1207" font-size="18" fill="#fff">â‘§</text>
  <text x="220" y="1207" font-size="14" font-weight="600" fill="#fff">è¿”å› PipelineResult</text>
  <text x="220" y="1225" font-size="10" fill="rgba(255,255,255,.8)">{ success, state, events } â†’ ä¼ è¾“å±‚å¹¿æ’­</text>
</g>

<!-- ================================================================ -->
<!-- ä¸‰ã€11 ä¸ªç³»ç»Ÿæ’ä»¶çŸ©é˜µ -->
<!-- ================================================================ -->
<text x="60" y="1300" class="sec">ä¸‰ã€11 ä¸ªç³»ç»Ÿæ’ä»¶ â€” æ¯ä¸ªç³»ç»Ÿåœ¨ç®¡çº¿çš„å“ªé‡Œåšä»€ä¹ˆ</text>
<line x1="60" y1="1308" x2="540" y2="1308" stroke="#e2e8f0" stroke-width="2"/>
<text x="60" y="1328" class="note">ç³»ç»Ÿé€šè¿‡ beforeCommand / afterEvents ä¸¤ä¸ªé’©å­ä»‹å…¥ç®¡çº¿ï¼Œä¸ä¿®æ”¹é¢†åŸŸé€»è¾‘</text>

<rect x="60" y="1345" width="260" height="32" rx="6" fill="#0f172a"/>
<text x="190" y="1366" text-anchor="middle" font-size="12" font-weight="600" fill="#fff">ç³»ç»Ÿåç§°</text>
<rect x="325" y="1345" width="340" height="32" rx="6" fill="#0f172a"/>
<text x="495" y="1366" text-anchor="middle" font-size="12" font-weight="600" fill="#fff">â‘¡ beforeCommandï¼ˆå‘½ä»¤åˆ°è¾¾æ—¶ï¼‰</text>
<rect x="670" y="1345" width="470" height="32" rx="6" fill="#0f172a"/>
<text x="905" y="1366" text-anchor="middle" font-size="12" font-weight="600" fill="#fff">â‘¦ afterEventsï¼ˆäº‹ä»¶äº§ç”Ÿåï¼‰</text>

<!-- 11 rows -->
<rect x="60" y="1382" width="260" height="36" rx="4" fill="#ecfdf5" stroke="#bbf7d0" stroke-width="1"/>
<text x="80" y="1405" font-size="12" font-weight="600" fill="#059669">ğŸ”„ FlowSystem</text>
<text x="165" y="1405" font-size="10" fill="#334155">å›åˆé˜¶æ®µç®¡ç†</text>
<rect x="325" y="1382" width="340" height="36" rx="4" fill="#fff" stroke="#e2e8f0" stroke-width="1"/>
<text x="335" y="1403" font-size="10" fill="#334155">æ‹¦æˆª ADVANCE_PHASE â†’ æ‰§è¡Œé˜¶æ®µåˆ‡æ¢é€»è¾‘</text>
<rect x="670" y="1382" width="470" height="36" rx="4" fill="#fff" stroke="#e2e8f0" stroke-width="1"/>
<text x="680" y="1403" font-size="10" fill="#334155">onAutoContinue â†’ è‡ªåŠ¨æ¨è¿›é˜¶æ®µï¼ˆå¦‚ upkeep/incomeï¼‰</text>

<rect x="60" y="1422" width="260" height="36" rx="4" fill="#eff6ff" stroke="#bfdbfe" stroke-width="1"/>
<text x="80" y="1445" font-size="12" font-weight="600" fill="#2563eb">ğŸ”’ UndoSystem</text>
<text x="160" y="1445" font-size="10" fill="#334155">æ’¤é”€/å¿«ç…§</text>
<rect x="325" y="1422" width="340" height="36" rx="4" fill="#fff" stroke="#e2e8f0" stroke-width="1"/>
<text x="335" y="1443" font-size="10" fill="#334155">ç™½åå•å‘½ä»¤ â†’ ä¿å­˜çŠ¶æ€å¿«ç…§ï¼ˆç”¨äº Ctrl+Zï¼‰</text>
<rect x="670" y="1422" width="470" height="36" rx="4" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>
<text x="680" y="1443" font-size="10" fill="#94a3b8">â€”</text>

<rect x="60" y="1462" width="260" height="36" rx="4" fill="#fef3c7" stroke="#fde68a" stroke-width="1"/>
<text x="80" y="1485" font-size="12" font-weight="600" fill="#d97706">ğŸ¯ InteractionSystem</text>
<text x="195" y="1485" font-size="10" fill="#334155">ç©å®¶äº¤äº’</text>
<rect x="325" y="1462" width="340" height="36" rx="4" fill="#fff" stroke="#e2e8f0" stroke-width="1"/>
<text x="335" y="1483" font-size="10" fill="#334155">æ¶ˆè´¹ RESOLVE_CHOICE â†’ è§£æç©å®¶é€‰æ‹©</text>
<rect x="670" y="1462" width="470" height="36" rx="4" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>
<text x="680" y="1483" font-size="10" fill="#94a3b8">â€”</text>

<rect x="60" y="1502" width="260" height="36" rx="4" fill="#ecfeff" stroke="#a5f3fc" stroke-width="1"/>
<text x="80" y="1525" font-size="12" font-weight="600" fill="#0891b2">ğŸªŸ ResponseWindow</text>
<text x="190" y="1525" font-size="10" fill="#334155">å“åº”çª—å£</text>
<rect x="325" y="1502" width="340" height="36" rx="4" fill="#fff" stroke="#e2e8f0" stroke-width="1"/>
<text x="335" y="1523" font-size="10" fill="#334155">éå½“å‰å“åº”è€… â†’ é˜»å¡ï¼ˆä»…å…è®¸ç™½åå•å‘½ä»¤ï¼‰</text>
<rect x="670" y="1502" width="470" height="36" rx="4" fill="#fff" stroke="#e2e8f0" stroke-width="1"/>
<text x="680" y="1523" font-size="10" fill="#334155">æ£€æµ‹è§¦å‘äº‹ä»¶ â†’ æ‰“å¼€/å…³é—­å¤šç©å®¶å“åº”çª—å£</text>

<rect x="60" y="1542" width="260" height="36" rx="4" fill="#fdf4ff" stroke="#f0abfc" stroke-width="1"/>
<text x="80" y="1565" font-size="12" font-weight="600" fill="#a21caf">ğŸ“– TutorialSystem</text>
<text x="185" y="1565" font-size="10" fill="#334155">åˆ†æ­¥æ•™å­¦</text>
<rect x="325" y="1542" width="340" height="36" rx="4" fill="#fff" stroke="#e2e8f0" stroke-width="1"/>
<text x="335" y="1563" font-size="10" fill="#334155">å‘½ä»¤é—¨æ§ â†’ åªå…è®¸å½“å‰æ•™å­¦æ­¥éª¤çš„å‘½ä»¤é€šè¿‡</text>
<rect x="670" y="1542" width="470" height="36" rx="4" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>
<text x="680" y="1563" font-size="10" fill="#94a3b8">â€”</text>

<rect x="60" y="1582" width="260" height="36" rx="4" fill="#fef2f2" stroke="#fecaca" stroke-width="1"/>
<text x="80" y="1605" font-size="12" font-weight="600" fill="#dc2626">ğŸ® CheatSystem</text>
<text x="178" y="1605" font-size="10" fill="#334155">è°ƒè¯•ä½œå¼Š</text>
<rect x="325" y="1582" width="340" height="36" rx="4" fill="#fff" stroke="#e2e8f0" stroke-width="1"/>
<text x="335" y="1603" font-size="10" fill="#334155">æ¶ˆè´¹ SYS_CHEAT_* â†’ ä¿®æ”¹èµ„æº/éª°å­/é˜¶æ®µ</text>
<rect x="670" y="1582" width="470" height="36" rx="4" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>
<text x="680" y="1603" font-size="10" fill="#94a3b8">â€”</text>

<rect x="60" y="1622" width="260" height="36" rx="4" fill="#fff7ed" stroke="#fed7aa" stroke-width="1"/>
<text x="80" y="1645" font-size="12" font-weight="600" fill="#c2410c">ğŸ‘¤ CharacterSelection</text>
<text x="210" y="1645" font-size="10" fill="#334155">é€‰è§’</text>
<rect x="325" y="1622" width="340" height="36" rx="4" fill="#fff" stroke="#e2e8f0" stroke-width="1"/>
<text x="335" y="1643" font-size="10" fill="#334155">æ¶ˆè´¹é€‰è§’/å‡†å¤‡/å¼€å§‹å‘½ä»¤ â†’ ç”Ÿæˆé€‰è§’äº‹ä»¶</text>
<rect x="670" y="1622" width="470" height="36" rx="4" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>
<text x="680" y="1643" font-size="10" fill="#94a3b8">â€”</text>

<rect x="60" y="1662" width="260" height="36" rx="4" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
<text x="80" y="1685" font-size="12" font-weight="600" fill="#475569">ğŸ“‹ LogSystem</text>
<text x="160" y="1685" font-size="10" fill="#334155">åŸå§‹æ—¥å¿—</text>
<rect x="325" y="1662" width="340" height="36" rx="4" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>
<text x="335" y="1683" font-size="10" fill="#94a3b8">â€”</text>
<rect x="670" y="1662" width="470" height="36" rx="4" fill="#fff" stroke="#e2e8f0" stroke-width="1"/>
<text x="680" y="1683" font-size="10" fill="#334155">è®°å½•å‘½ä»¤+äº‹ä»¶åˆ° sys.logï¼ˆè°ƒè¯•/å®¡è®¡ç”¨ï¼‰</text>

<rect x="60" y="1702" width="260" height="36" rx="4" fill="#ecfeff" stroke="#a5f3fc" stroke-width="1"/>
<text x="80" y="1725" font-size="12" font-weight="600" fill="#0891b2">ğŸ“¡ EventStream</text>
<text x="175" y="1725" font-size="10" fill="#334155">äº‹ä»¶æ¨é€</text>
<rect x="325" y="1702" width="340" height="36" rx="4" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>
<text x="335" y="1723" font-size="10" fill="#94a3b8">â€”</text>
<rect x="670" y="1702" width="470" height="36" rx="4" fill="#fff" stroke="#e2e8f0" stroke-width="1"/>
<text x="680" y="1723" font-size="10" fill="#334155">å†™å…¥ sys.eventStream â†’ UI æ¶ˆè´¹æ’­æ”¾ç‰¹æ•ˆ/éŸ³æ•ˆ</text>

<rect x="60" y="1742" width="260" height="36" rx="4" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
<text x="80" y="1765" font-size="12" font-weight="600" fill="#475569">ğŸ“ ActionLog</text>
<text x="170" y="1765" font-size="10" fill="#334155">æ“ä½œè®°å½•</text>
<rect x="325" y="1742" width="340" height="36" rx="4" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>
<text x="335" y="1763" font-size="10" fill="#94a3b8">â€”</text>
<rect x="670" y="1742" width="470" height="36" rx="4" fill="#fff" stroke="#e2e8f0" stroke-width="1"/>
<text x="680" y="1763" font-size="10" fill="#334155">æ ¼å¼åŒ–å‘½ä»¤+äº‹ä»¶ â†’ ç»“æ„åŒ–æ“ä½œæ—¥å¿—ï¼ˆç”¨æˆ·å¯è§ï¼‰</text>

<rect x="60" y="1782" width="260" height="36" rx="4" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
<text x="80" y="1805" font-size="12" font-weight="600" fill="#475569">ğŸ” RematchSystem</text>
<text x="190" y="1805" font-size="10" fill="#334155">é‡èµ›æŠ•ç¥¨</text>
<rect x="325" y="1782" width="340" height="36" rx="4" fill="#fff" stroke="#e2e8f0" stroke-width="1"/>
<text x="335" y="1803" font-size="10" fill="#334155">æ¶ˆè´¹ REMATCH_VOTE â†’ è®°å½•æŠ•ç¥¨</text>
<rect x="670" y="1782" width="470" height="36" rx="4" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>
<text x="680" y="1803" font-size="10" fill="#94a3b8">â€”</text>

<!-- ================================================================ -->
<!-- å››ã€10 ä¸ªåŸºç¡€èƒ½åŠ› -->
<!-- ================================================================ -->
<text x="60" y="1880" class="sec">å››ã€10 ä¸ªåŸºç¡€èƒ½åŠ› â€” æ¸¸æˆå±‚å¯ç›´æ¥è°ƒç”¨çš„çº¯å‡½æ•°å·¥å…·åº“</text>
<line x1="60" y1="1888" x2="540" y2="1888" stroke="#e2e8f0" stroke-width="2"/>
<text x="60" y="1908" class="note">engine/primitives/ ä¸‹çš„å·¥å…·æ¨¡å—ã€‚çº¯å‡½æ•°ã€ä¸å¯å˜ã€æ— å‰¯ä½œç”¨ã€‚æ¸¸æˆæ³¨å†Œå¤„ç†å™¨ï¼Œå¼•æ“è´Ÿè´£è°ƒåº¦ã€‚</text>

<!-- Row 1: 5 cards -->
<g class="card">
  <rect x="60" y="1928" width="215" height="100" rx="8" fill="#fff" stroke="#e2e8f0" stroke-width="1.5"/>
  <rect x="60" y="1928" width="215" height="28" rx="8" fill="#f59e0b"/><rect x="60" y="1944" width="215" height="12" fill="#f59e0b"/>
  <text x="85" y="1948" font-size="13" font-weight="600" fill="#fff">ğŸ² dice éª°å­æ“ä½œ</text>
  <text x="75" y="1978" class="mono">createDie Â· rollDice</text>
  <text x="75" y="1993" class="mono">calculateDiceStats</text>
  <text x="75" y="2010" font-size="9" fill="#f59e0b" font-weight="600">DiceThrone</text>
</g>
<g class="card">
  <rect x="285" y="1928" width="215" height="100" rx="8" fill="#fff" stroke="#e2e8f0" stroke-width="1.5"/>
  <rect x="285" y="1928" width="215" height="28" rx="8" fill="#f59e0b"/><rect x="285" y="1944" width="215" height="12" fill="#f59e0b"/>
  <text x="310" y="1948" font-size="13" font-weight="600" fill="#fff">ğŸƒ zones å¡ç‰ŒåŒºåŸŸ</text>
  <text x="300" y="1978" class="mono">moveCard Â· drawCards</text>
  <text x="300" y="1993" class="mono">discardFromHand Â· shuffle</text>
  <text x="300" y="2010" font-size="9" fill="#f59e0b" font-weight="600">DiceThrone Â· SummonerWars Â· SmashUp</text>
</g>
<g class="card">
  <rect x="510" y="1928" width="215" height="100" rx="8" fill="#fff" stroke="#e2e8f0" stroke-width="1.5"/>
  <rect x="510" y="1928" width="215" height="28" rx="8" fill="#f59e0b"/><rect x="510" y="1944" width="215" height="12" fill="#f59e0b"/>
  <text x="535" y="1948" font-size="13" font-weight="600" fill="#fff">ğŸ’ resources èµ„æº</text>
  <text x="525" y="1978" class="mono">modifyResource Â· canAfford</text>
  <text x="525" y="1993" class="mono">payResources Â· clampValue</text>
  <text x="525" y="2010" font-size="9" fill="#f59e0b" font-weight="600">DiceThrone Â· SummonerWars</text>
</g>
<g class="card">
  <rect x="735" y="1928" width="215" height="100" rx="8" fill="#fff" stroke="#e2e8f0" stroke-width="1.5"/>
  <rect x="735" y="1928" width="215" height="28" rx="8" fill="#f59e0b"/><rect x="735" y="1944" width="215" height="12" fill="#f59e0b"/>
  <text x="760" y="1948" font-size="13" font-weight="600" fill="#fff">ğŸ“ grid äºŒç»´ç½‘æ ¼</text>
  <text x="750" y="1978" class="mono">findOnGrid Â· collectOnGrid</text>
  <text x="750" y="1993" class="mono">getAdjacentPositions</text>
  <text x="750" y="2010" font-size="9" fill="#f59e0b" font-weight="600">SummonerWars</text>
</g>
<g class="card">
  <rect x="960" y="1928" width="180" height="100" rx="8" fill="#fff" stroke="#e2e8f0" stroke-width="1.5"/>
  <rect x="960" y="1928" width="180" height="28" rx="8" fill="#f59e0b"/><rect x="960" y="1944" width="180" height="12" fill="#f59e0b"/>
  <text x="985" y="1948" font-size="13" font-weight="600" fill="#fff">ğŸ¯ target ç›®æ ‡</text>
  <text x="975" y="1978" class="mono">resolveTarget</text>
  <text x="975" y="1993" class="mono">+ æ³¨å†Œå™¨æ¨¡å¼</text>
  <text x="975" y="2010" font-size="9" fill="#f59e0b" font-weight="600">SummonerWars</text>
</g>

<!-- Row 2: 5 cards -->
<g class="card">
  <rect x="60" y="2040" width="215" height="100" rx="8" fill="#fff" stroke="#e2e8f0" stroke-width="1.5"/>
  <rect x="60" y="2040" width="215" height="28" rx="8" fill="#d97706"/><rect x="60" y="2056" width="215" height="12" fill="#d97706"/>
  <text x="85" y="2060" font-size="13" font-weight="600" fill="#fff">âš¡ effects æ•ˆæœæ¡†æ¶</text>
  <text x="75" y="2090" class="mono">executeEffect(s)</text>
  <text x="75" y="2105" class="mono">æ³¨å†Œå™¨: æ¸¸æˆå®šä¹‰æ•ˆæœç±»å‹</text>
  <text x="75" y="2122" font-size="9" fill="#d97706" font-weight="600">DiceThrone Â· SummonerWars</text>
</g>
<g class="card">
  <rect x="285" y="2040" width="215" height="100" rx="8" fill="#fff" stroke="#e2e8f0" stroke-width="1.5"/>
  <rect x="285" y="2040" width="215" height="28" rx="8" fill="#d97706"/><rect x="285" y="2056" width="215" height="12" fill="#d97706"/>
  <text x="310" y="2060" font-size="13" font-weight="600" fill="#fff">ğŸ“Š expression è¡¨è¾¾å¼</text>
  <text x="300" y="2090" class="mono">evaluateExpression</text>
  <text x="300" y="2105" class="mono">lit Â· ref Â· add Â· mul Â· sub</text>
  <text x="300" y="2122" font-size="9" fill="#d97706" font-weight="600">æ•°å€¼è®¡ç®— Â· ä¼¤å®³å…¬å¼</text>
</g>
<g class="card">
  <rect x="510" y="2040" width="215" height="100" rx="8" fill="#fff" stroke="#e2e8f0" stroke-width="1.5"/>
  <rect x="510" y="2040" width="215" height="28" rx="8" fill="#d97706"/><rect x="510" y="2056" width="215" height="12" fill="#d97706"/>
  <text x="535" y="2060" font-size="13" font-weight="600" fill="#fff">â“ condition æ¡ä»¶</text>
  <text x="525" y="2090" class="mono">evaluateCondition</text>
  <text x="525" y="2105" class="mono">and Â· or Â· not Â· compare</text>
  <text x="525" y="2122" font-size="9" fill="#d97706" font-weight="600">æ¡ä»¶æ•ˆæœ Â· è§¦å‘åˆ¤å®š</text>
</g>
<g class="card">
  <rect x="735" y="2040" width="215" height="100" rx="8" fill="#fff" stroke="#e2e8f0" stroke-width="1.5"/>
  <rect x="735" y="2040" width="215" height="28" rx="8" fill="#d97706"/><rect x="735" y="2056" width="215" height="12" fill="#d97706"/>
  <text x="760" y="2060" font-size="13" font-weight="600" fill="#fff">ğŸ–¼ visual è§†è§‰è§£æ</text>
  <text x="750" y="2090" class="mono">VisualResolver</text>
  <text x="750" y="2105" class="mono">çº¦å®šå¼: entityId â†’ atlaså¸§</text>
  <text x="750" y="2122" font-size="9" fill="#d97706" font-weight="600">DiceThrone Token/Status å›¾æ ‡</text>
</g>
<g class="card">
  <rect x="960" y="2040" width="180" height="100" rx="8" fill="#fff" stroke="#e2e8f0" stroke-width="1.5"/>
  <rect x="960" y="2040" width="180" height="28" rx="8" fill="#d97706"/><rect x="960" y="2056" width="180" height="12" fill="#d97706"/>
  <text x="985" y="2060" font-size="13" font-weight="600" fill="#fff">ğŸ“‹ actionRegistry</text>
  <text x="975" y="2090" class="mono">ActionHandlerRegistry</text>
  <text x="975" y="2105" class="mono">register Â· get Â· has</text>
  <text x="975" y="2122" font-size="9" fill="#d97706" font-weight="600">DTæŠ€èƒ½ Â· SWæŠ€èƒ½</text>
</g>

<!-- ================================================================ -->
<!-- äº”ã€æ¸¸æˆæ¥å…¥ + MatchState -->
<!-- ================================================================ -->
<text x="60" y="2210" class="sec">äº”ã€æ¸¸æˆå¦‚ä½•æ¥å…¥å¼•æ“</text>
<line x1="60" y1="2218" x2="290" y2="2218" stroke="#e2e8f0" stroke-width="2"/>
<text x="60" y="2238" class="note">æ¯ä¸ªæ¸¸æˆå®ç° DomainCore æ¥å£çš„ 5 ä¸ªå‡½æ•° â†’ createGameEngine() ç»„è£…ä¸ºå¯è¿è¡Œçš„æ¸¸æˆå¼•æ“</text>

<g class="card">
  <rect x="60" y="2260" width="500" height="220" rx="12" fill="#fff" stroke="#10b981" stroke-width="2"/>
  <text x="310" y="2288" text-anchor="middle" font-size="15" font-weight="700" fill="#059669">DomainCore æ¥å£ â€” æ¸¸æˆå¿…é¡»å®ç°</text>
  <line x1="75" y1="2298" x2="545" y2="2298" stroke="#d1fae5" stroke-width="1"/>
  <text x="85" y="2322" font-size="12" fill="#059669" font-weight="600">å¿…é€‰ï¼ˆ4 ä¸ªï¼‰</text>
  <text x="85" y="2342" class="mono">setup(playerIds, random)  â†’ TCore åˆå§‹çŠ¶æ€</text>
  <text x="85" y="2362" class="mono">validate(state, command)  â†’ åˆæ³•æ€§æ ¡éªŒ</text>
  <text x="85" y="2382" class="mono">execute(state, cmd, rand) â†’ Event[] äº‹ä»¶</text>
  <text x="85" y="2402" class="mono">reduce(core, event)       â†’ TCore æ–°çŠ¶æ€</text>
  <line x1="85" y1="2415" x2="540" y2="2415" stroke="#d1fae5" stroke-width="1"/>
  <text x="85" y="2435" font-size="12" fill="#64748b" font-weight="600">å¯é€‰ï¼ˆ4 ä¸ªï¼‰</text>
  <text x="85" y="2455" class="mono">postProcess? Â· interceptEvent? Â· playerView? Â· isGameOver?</text>
</g>

<g class="card">
  <rect x="590" y="2260" width="550" height="220" rx="12" fill="#fff" stroke="#e2e8f0" stroke-width="2"/>
  <text x="865" y="2288" text-anchor="middle" font-size="15" font-weight="700" fill="#1e293b">MatchState&lt;TCore&gt; â€” ç»Ÿä¸€çŠ¶æ€ç»“æ„</text>
  <line x1="605" y1="2298" x2="1125" y2="2298" stroke="#e2e8f0" stroke-width="1"/>
  <rect x="610" y="2310" width="250" height="155" rx="8" fill="#eff6ff" stroke="#bfdbfe" stroke-width="1"/>
  <text x="735" y="2330" text-anchor="middle" font-size="13" font-weight="600" fill="#2563eb">sys: SystemState</text>
  <text x="735" y="2346" text-anchor="middle" font-size="10" fill="#64748b">è·¨æ¸¸æˆé€šç”¨ Â· ç³»ç»Ÿè‡ªè¡Œç®¡ç†</text>
  <line x1="620" y1="2353" x2="850" y2="2353" stroke="#bfdbfe" stroke-width="1"/>
  <rect x="620" y="2360" width="60" height="22" rx="4" fill="#3b82f6"/><text x="650" y="2376" text-anchor="middle" font-size="9" font-weight="500" fill="#fff">phase</text>
  <rect x="686" y="2360" width="52" height="22" rx="4" fill="#3b82f6"/><text x="712" y="2376" text-anchor="middle" font-size="9" font-weight="500" fill="#fff">undo</text>
  <rect x="744" y="2360" width="50" height="22" rx="4" fill="#3b82f6"/><text x="769" y="2376" text-anchor="middle" font-size="9" font-weight="500" fill="#fff">log</text>
  <rect x="800" y="2360" width="50" height="22" rx="4" fill="#3b82f6"/><text x="825" y="2376" text-anchor="middle" font-size="9" font-weight="500" fill="#fff">event</text>
  <rect x="620" y="2390" width="72" height="22" rx="4" fill="#0891b2"/><text x="656" y="2406" text-anchor="middle" font-size="9" font-weight="500" fill="#fff">interaction</text>
  <rect x="698" y="2390" width="65" height="22" rx="4" fill="#0891b2"/><text x="730" y="2406" text-anchor="middle" font-size="9" font-weight="500" fill="#fff">response</text>
  <rect x="769" y="2390" width="55" height="22" rx="4" fill="#0891b2"/><text x="796" y="2406" text-anchor="middle" font-size="9" font-weight="500" fill="#fff">tutorial</text>
  <rect x="830" y="2390" width="25" height="22" rx="4" fill="#0891b2"/><text x="842" y="2406" text-anchor="middle" font-size="8" font-weight="500" fill="#fff">...</text>
  <rect x="620" y="2420" width="68" height="22" rx="4" fill="#64748b"/><text x="654" y="2436" text-anchor="middle" font-size="9" font-weight="500" fill="#fff">actionLog</text>
  <rect x="694" y="2420" width="56" height="22" rx="4" fill="#64748b"/><text x="722" y="2436" text-anchor="middle" font-size="9" font-weight="500" fill="#fff">stream</text>
  <rect x="756" y="2420" width="56" height="22" rx="4" fill="#64748b"/><text x="784" y="2436" text-anchor="middle" font-size="9" font-weight="500" fill="#fff">rematch</text>

  <rect x="875" y="2310" width="250" height="155" rx="8" fill="#f0fdf4" stroke="#bbf7d0" stroke-width="1"/>
  <text x="1000" y="2330" text-anchor="middle" font-size="13" font-weight="600" fill="#059669">core: TCore</text>
  <text x="1000" y="2346" text-anchor="middle" font-size="10" fill="#64748b">æ¸¸æˆé¢†åŸŸçŠ¶æ€ Â· æ¯æ¸¸æˆä¸åŒ</text>
  <line x1="885" y1="2353" x2="1115" y2="2353" stroke="#bbf7d0" stroke-width="1"/>
  <rect x="885" y="2362" width="110" height="40" rx="5" fill="#10b981"/>
  <text x="940" y="2380" text-anchor="middle" font-size="10" font-weight="500" fill="#fff">DiceThroneCore</text>
  <text x="940" y="2395" text-anchor="middle" font-size="8" fill="rgba(255,255,255,.8)">éª°å­/å¡ç‰Œ/æŠ€èƒ½</text>
  <rect x="1000" y="2362" width="115" height="40" rx="5" fill="#10b981"/>
  <text x="1057" y="2380" text-anchor="middle" font-size="10" font-weight="500" fill="#fff">SummonerWarsCore</text>
  <text x="1057" y="2395" text-anchor="middle" font-size="8" fill="rgba(255,255,255,.8)">æ£‹ç›˜/å•ä½/é­”åŠ›</text>
  <rect x="885" y="2410" width="110" height="40" rx="5" fill="#059669"/>
  <text x="940" y="2428" text-anchor="middle" font-size="10" font-weight="500" fill="#fff">SmashUpCore</text>
  <text x="940" y="2443" text-anchor="middle" font-size="8" fill="rgba(255,255,255,.8)">åŸºåœ°/é˜µè¥/æ‰“å‡º</text>
  <rect x="1000" y="2410" width="115" height="40" rx="5" fill="#059669"/>
  <text x="1057" y="2428" text-anchor="middle" font-size="10" font-weight="500" fill="#fff">TicTacToeCore</text>
  <text x="1057" y="2443" text-anchor="middle" font-size="8" fill="rgba(255,255,255,.8)">æ£‹ç›˜/å½“å‰ç©å®¶</text>
</g>

<!-- ================================================================ -->
<!-- å…­ã€å®Œæ•´æ•°æ®æµ -->
<!-- ================================================================ -->
<text x="60" y="2550" class="sec">å…­ã€ä¸€æ¬¡å®Œæ•´æ“ä½œçš„æ•°æ®æµ</text>
<line x1="60" y1="2558" x2="340" y2="2558" stroke="#e2e8f0" stroke-width="2"/>

<g class="card">
  <rect x="60" y="2575" width="1080" height="380" rx="14" fill="#fff" stroke="#e2e8f0" stroke-width="1.5"/>

  <!-- å·¦åˆ— -->
  <rect x="85" y="2595" width="250" height="34" rx="7" fill="#3b82f6"/>
  <text x="210" y="2617" text-anchor="middle" font-size="12" font-weight="500" fill="#fff">â‘  ç©å®¶ç‚¹å‡» UI æŒ‰é’®</text>
  <text x="210" y="2643" text-anchor="middle" class="note">â–¼</text>
  <rect x="85" y="2650" width="250" height="34" rx="7" fill="#10b981"/>
  <text x="210" y="2672" text-anchor="middle" font-size="12" font-weight="500" fill="#fff">â‘¡ Board.tsx â†’ dispatch(CMD, payload)</text>
  <text x="210" y="2698" text-anchor="middle" class="note">â–¼</text>
  <rect x="85" y="2705" width="250" height="34" rx="7" fill="#8b5cf6"/>
  <text x="210" y="2727" text-anchor="middle" font-size="12" font-weight="500" fill="#fff">â‘¢ socket.io åºåˆ—åŒ–ä¼ è¾“</text>
  <text x="210" y="2753" text-anchor="middle" class="note">â–¼</text>
  <rect x="85" y="2760" width="250" height="34" rx="7" fill="#f59e0b"/>
  <text x="210" y="2782" text-anchor="middle" font-size="12" font-weight="500" fill="#fff">â‘£ TransportServer â†’ Command å¯¹è±¡</text>
  <text x="210" y="2808" text-anchor="middle" class="note">â–¼</text>
  <rect x="85" y="2815" width="250" height="34" rx="7" fill="#ef4444"/>
  <text x="210" y="2837" text-anchor="middle" font-size="12" font-weight="500" fill="#fff">â‘¤ executePipeline() â€” è§ä¸Šæ–¹è¯¦è§£</text>

  <!-- ä¸­åˆ— -->
  <line x1="335" y1="2832" x2="385" y2="2832" stroke="#ef4444" stroke-width="1.5" stroke-dasharray="4,3" marker-end="url(#aR)"/>
  <rect x="390" y="2590" width="290" height="270" rx="10" fill="#fef2f2" stroke="#fecaca" stroke-width="1"/>
  <text x="535" y="2614" text-anchor="middle" font-size="13" font-weight="600" fill="#dc2626">executePipeline æ‘˜è¦</text>
  <line x1="405" y1="2622" x2="665" y2="2622" stroke="#fecaca" stroke-width="1"/>
  <text x="405" y="2645" font-size="11" fill="#334155">â‘¡ beforeCommand ç³»ç»Ÿæ‹¦æˆª</text>
  <text x="410" y="2662" font-size="9" fill="#64748b">Undo/Flow/ResponseWindow/Tutorial</text>
  <text x="405" y="2685" font-size="11" fill="#334155">â‘¢ validate é¢†åŸŸæ ¡éªŒ</text>
  <text x="405" y="2710" font-size="11" fill="#334155">â‘£ execute â†’ Event[]</text>
  <text x="405" y="2735" font-size="11" fill="#334155">â‘¤ postProcess æ´¾ç”Ÿäº‹ä»¶</text>
  <text x="405" y="2760" font-size="11" fill="#334155">â‘¥ interceptEvent + reduce å¾ªç¯</text>
  <text x="405" y="2785" font-size="11" fill="#334155">â‘¦ afterEvents ç³»ç»Ÿå“åº”</text>
  <text x="410" y="2802" font-size="9" fill="#64748b">Log/EventStream/Flow/ResponseWindow</text>
  <text x="405" y="2830" font-size="11" font-weight="600" fill="#dc2626">â†’ PipelineResult { state, events }</text>
  <text x="405" y="2850" font-size="10" fill="#64748b">å¤šè½®è¿­ä»£ï¼ˆæœ€å¤š 10 è½®ï¼‰</text>

  <!-- å³åˆ— -->
  <line x1="680" y1="2832" x2="720" y2="2832" stroke="#22c55e" stroke-width="1.5" stroke-dasharray="4,3" marker-end="url(#aG)"/>
  <rect x="725" y="2595" width="390" height="34" rx="7" fill="#22c55e"/>
  <text x="920" y="2617" text-anchor="middle" font-size="12" font-weight="500" fill="#fff">â‘¥ state = result.state â€” ä¸å¯å˜æ›´æ–°</text>
  <text x="920" y="2643" text-anchor="middle" class="note">â–¼</text>
  <rect x="725" y="2650" width="390" height="34" rx="7" fill="#0ea5e9"/>
  <text x="920" y="2672" text-anchor="middle" font-size="12" font-weight="500" fill="#fff">â‘¦ TransportServer å¹¿æ’­ â†’ WebSocket â†’ æ‰€æœ‰å®¢æˆ·ç«¯</text>
  <text x="920" y="2698" text-anchor="middle" class="note">â–¼</text>
  <rect x="725" y="2705" width="390" height="34" rx="7" fill="#3b82f6"/>
  <text x="920" y="2727" text-anchor="middle" font-size="12" font-weight="500" fill="#fff">â‘§ React é‡æ¸²æŸ“ Board.tsx</text>
  <text x="920" y="2753" text-anchor="middle" class="note">â–¼</text>
  <rect x="725" y="2760" width="390" height="34" rx="7" fill="#8b5cf6"/>
  <text x="920" y="2782" text-anchor="middle" font-size="12" font-weight="500" fill="#fff">â‘¨ EventStream â†’ ç‰¹æ•ˆ / éŸ³æ•ˆæ’­æ”¾</text>
  <text x="920" y="2808" text-anchor="middle" class="note">â–¼</text>
  <rect x="725" y="2815" width="390" height="34" rx="7" fill="#6b7280"/>
  <text x="920" y="2837" text-anchor="middle" font-size="12" font-weight="500" fill="#fff">â‘© playerView è¿‡æ»¤éšè—ä¿¡æ¯ï¼ˆè”æœºæ¨¡å¼ï¼‰</text>

  <path d="M 920 2860 L 920 2930 L 210 2930 L 210 2595" fill="none" stroke="#94a3b8" stroke-width="1" stroke-dasharray="6,4"/>
  <text x="565" y="2944" text-anchor="middle" font-size="10" fill="#94a3b8">ç©å®¶çœ‹åˆ°æ›´æ–°åçš„çŠ¶æ€ â†’ ä¸‹ä¸€æ¬¡æ“ä½œ â†’ å¾ªç¯</text>
</g>

<!-- ================================================================ -->
<!-- åº•éƒ¨ -->
<!-- ================================================================ -->
<text x="600" y="3000" text-anchor="middle" font-size="12" fill="#94a3b8">BordGame Engine Architecture v5 Â· 2026-02</text>
<text x="600" y="3020" text-anchor="middle" font-size="11" fill="#94a3b8">10 Primitives Â· 11 Systems Â· executePipeline Â· MatchState&lt;TCore&gt;</text>

<g class="card">
  <rect x="60" y="3050" width="1080" height="120" rx="12" fill="#0f172a"/>
  <text x="600" y="3078" text-anchor="middle" font-size="14" font-weight="700" fill="#fff">æ ¸å¿ƒè®¾è®¡åŸåˆ™</text>
  <text x="100" y="3102" font-size="11" fill="#94a3b8">ğŸ— åˆ†å±‚ä¸¥æ ¼å•å‘</text>
  <text x="100" y="3118" font-size="10" fill="#64748b">UI â†’ æ¸¸æˆ â†’ å¼•æ“ â†’ æ ¸å¿ƒï¼Œç¦æ­¢é€†å‘ä¾èµ–</text>
  <text x="340" y="3102" font-size="11" fill="#94a3b8">ğŸ“¦ å‘½ä»¤/äº‹ä»¶é©±åŠ¨</text>
  <text x="340" y="3118" font-size="10" fill="#64748b">Command â†’ Event[] â†’ reduce()ï¼Œæ”¯æŒæ’¤é”€/å›æ”¾</text>
  <text x="610" y="3102" font-size="11" fill="#94a3b8">ğŸ”Œ ç³»ç»Ÿæ’ä»¶åŒ–</text>
  <text x="610" y="3118" font-size="10" fill="#64748b">æ¸¸æˆæŒ‰éœ€é€‰æ‹©ç³»ç»Ÿï¼Œç³»ç»Ÿä¸ä¿®æ”¹é¢†åŸŸé€»è¾‘</text>
  <text x="850" y="3102" font-size="11" fill="#94a3b8">ğŸ§© é¢å‘ç™¾æ¸¸æˆ</text>
  <text x="850" y="3118" font-size="10" fill="#64748b">æ¯ä¸ªå†³ç­–è€ƒè™‘ 100 ä¸ªæ¸¸æˆéƒ½è¿™æ ·åšä¼šæ€æ ·</text>
  <text x="100" y="3145" font-size="11" fill="#94a3b8">âš¡ çº¯å‡½æ•°ä¸å¯å˜</text>
  <text x="100" y="3161" font-size="10" fill="#64748b">reduce å¿…é¡»ç»“æ„å…±äº«ï¼Œç¦æ­¢ JSON æ·±æ‹·è´</text>
  <text x="340" y="3145" font-size="11" fill="#94a3b8">ğŸ® é¢†åŸŸéš”ç¦»</text>
  <text x="340" y="3161" font-size="10" fill="#64748b">æ¸¸æˆé—´é›¶è€¦åˆï¼Œå¼•æ“å±‚ç¦æ­¢ import æ¸¸æˆå±‚</text>
  <text x="610" y="3145" font-size="11" fill="#94a3b8">ğŸ“¡ äº‹ä»¶æ¶ˆè´¹åˆ†ç¦»</text>
  <text x="610" y="3161" font-size="10" fill="#64748b">ç‰¹æ•ˆ/éŸ³æ•ˆé€šè¿‡ EventStreamï¼Œä¸æ±¡æŸ“çŠ¶æ€</text>
  <text x="850" y="3145" font-size="11" fill="#94a3b8">ğŸ”§ æ³¨å†Œå™¨æ¨¡å¼</text>
  <text x="850" y="3161" font-size="10" fill="#64748b">æ¸¸æˆæ³¨å†Œå¤„ç†å™¨ï¼Œå¼•æ“è´Ÿè´£è°ƒåº¦</text>
</g>

</svg>
